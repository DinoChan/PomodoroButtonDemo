<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
    xmlns:behaviors="using:Microsoft.Toolkit.Uwp.UI.Animations.Behaviors"
    xmlns:local="using:PomodoroButtonDemo"
    xmlns:controls="using:Microsoft.Toolkit.Uwp.UI.Controls">

    <Style TargetType="local:OutlinePanel">
        <Setter Property="IsTabStop" Value="False" />
        <Setter Property="HorizontalAlignment" Value="Stretch"/>
        <Setter Property="VerticalAlignment" Value="Stretch"/>
        <Setter Property="IsHitTestVisible" Value="False"/>
        <Setter Property="Color" Value="{ThemeResource SystemBaseHighColor}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:OutlinePanel">
                    <Grid>
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualStateGroup.Transitions>
                                    <VisualTransition From="Normal" To="PointerOver" >
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="OutlineBorder" Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.8">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>

                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="OutlineBorder" Storyboard.TargetProperty="(UIElement.Visibility)">
                                                <DiscreteObjectKeyFrame KeyTime="00:00:00" Value="Visible"/>
                                                <DiscreteObjectKeyFrame KeyTime="00:00:0.8" Value="Collapsed"/>
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualTransition>
                                    <VisualTransition To="Normal" >
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="OutlineBorder" Storyboard.TargetProperty="Opacity" To="0.3" Duration="0:0:1.5">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>

                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="OutlineBorder" Storyboard.TargetProperty="(UIElement.Visibility)">
                                                <DiscreteObjectKeyFrame KeyTime="00:00:00" Value="Visible"/>
                                                <DiscreteObjectKeyFrame KeyTime="00:00:0.8" Value="Collapsed"/>
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualTransition>
                                </VisualStateGroup.Transitions>
                                <VisualState x:Name="Normal" >
                                    <VisualState.Setters>
                                        <Setter Target="Scale.ScaleX" Value="1"/>
                                        <Setter Target="Scale.ScaleY" Value="1"/>
                                        <Setter Target="OutlineBorder.Opacity" Value="0.3"/>
                                        <Setter Target="OutlineBorder.Visibility" Value="Collapsed"/>
                                    </VisualState.Setters>
                                </VisualState>
                                <VisualState x:Name="PointerOver">
                                    <VisualState.Setters>
                                        <Setter Target="Scale.ScaleX" Value="2.5"/>
                                        <Setter Target="Scale.ScaleY" Value="2.5"/>
                                        <Setter Target="OutlineBorder.Opacity" Value="0"/>
                                        <Setter Target="OutlineBorder.Visibility" Value="Visible"/>
                                    </VisualState.Setters>
                                </VisualState>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>
                        <Border x:Name="OutlineBorder" 
                                Visibility="Collapsed" 
                                Opacity="0.5"
                                HorizontalAlignment="{TemplateBinding HorizontalAlignment}"
                                VerticalAlignment="{TemplateBinding HorizontalAlignment}" >
                            <interactivity:Interaction.Behaviors>
                                <behaviors:Scale x:Name="Scale"
                                                    ScaleX="1"
                                                    ScaleY="1"
                                                    CenterX="12"
                                                    CenterY="12"
                                                    Duration="800"
                                                    Delay="0"
                                                    EasingType="Cubic"
                                                    EasingMode="EaseOut"
                                                    AutomaticallyStart="True"/>
                            </interactivity:Interaction.Behaviors>
                        </Border>
                    </Grid>

                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>


    <Style TargetType="local:DropShadowPanel">
        <Setter Property="IsTabStop"
                Value="False" />
        <Setter Property="HorizontalAlignment" Value="Stretch"/>
        <Setter Property="HorizontalContentAlignment" Value="Left"/>
        <Setter Property="VerticalAlignment" Value="Stretch"/>
        <Setter Property="VerticalContentAlignment" Value="Stretch"/>
        <Setter Property="IsHitTestVisible" Value="False"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:DropShadowPanel">
                    <Grid Background="{TemplateBinding Background}"
                          BorderBrush="{TemplateBinding BorderBrush}"
                          BorderThickness="{TemplateBinding BorderThickness}"
                          HorizontalAlignment="{TemplateBinding HorizontalAlignment}"
                          VerticalAlignment="{TemplateBinding VerticalAlignment}">
                        <Border x:Name="OutlineBorder" 
                                HorizontalAlignment="{TemplateBinding HorizontalAlignment}"
                                VerticalAlignment="{TemplateBinding HorizontalAlignment}" />

                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style TargetType="local:ButtonDecorator" x:Key="InsetPanel">
        <Setter Property="IsTabStop"
                Value="False" />
        <Setter Property="HorizontalAlignment" Value="Stretch"/>
        <Setter Property="HorizontalContentAlignment" Value="Left"/>
        <Setter Property="VerticalAlignment" Value="Stretch"/>
        <Setter Property="VerticalContentAlignment" Value="Stretch"/>
        <Setter Property="IsHitTestVisible" Value="False"/>
        <Setter Property="local:DropShadowPanel.BlurRadius" Value="3"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:ButtonDecorator">
                    <Grid Background="{TemplateBinding Background}"
                          BorderBrush="{TemplateBinding BorderBrush}"
                          BorderThickness="{TemplateBinding BorderThickness}"
                          HorizontalAlignment="{TemplateBinding HorizontalAlignment}"
                          VerticalAlignment="{TemplateBinding VerticalAlignment}">
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualStateGroup.Transitions>
                                    <VisualTransition From="Normal" To="PointerOver" >
                                        <VisualTransition.GeneratedEasingFunction>
                                            <CubicEase EasingMode="EaseOut" />
                                        </VisualTransition.GeneratedEasingFunction>
                                    </VisualTransition>
                                    <VisualTransition  To="Normal" GeneratedDuration="0:0:0.5">
                                        <VisualTransition.GeneratedEasingFunction>
                                            <CubicEase EasingMode="EaseIn" />
                                        </VisualTransition.GeneratedEasingFunction>

                                    </VisualTransition>
                                </VisualStateGroup.Transitions>
                                <VisualState x:Name="Normal" >
                                    <VisualState.Setters>
                                    </VisualState.Setters>
                                </VisualState>
                                <VisualState x:Name="PointerOver">
                                    <VisualState.Setters>
                                        <Setter Target="Shadow.Opacity" Value="0"/>
                                        <Setter Target="InsetShadow.Opacity" Value="1"/>
                                    </VisualState.Setters>
                                </VisualState>
                                <VisualState x:Name="Pressed">
                                    <VisualState.Setters>
                                        <Setter Target="Shadow.Opacity" Value="0"/>
                                        <Setter Target="InsetShadow.Opacity" Value="0.6"/>
                                    </VisualState.Setters>
                                </VisualState>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>

                        <local:DropShadowPanel x:Name="Shadow" 
                                               ShadowOpacity="{TemplateBinding local:DropShadowPanel.ShadowOpacity}"
                                               BlurRadius="{TemplateBinding local:DropShadowPanel.BlurRadius}"
                                               Color="{TemplateBinding local:DropShadowPanel.Color}"
                                               OffsetX="{TemplateBinding local:DropShadowPanel.OffsetX}"
                                               OffsetY="{TemplateBinding local:DropShadowPanel.OffsetY}"
                                               OffsetZ="{TemplateBinding local:DropShadowPanel.OffsetZ}"
                                               IsMasked="{TemplateBinding local:DropShadowPanel.IsMasked}"
                                               RelativeElement="{TemplateBinding RelativeElement}"/>


                        <local:DropShadowPanel x:Name="InsetShadow" 
                                               Opacity="0"
                                               ShadowOpacity="0.7"
                                               BlurRadius="3.5"
                                               Color="{ThemeResource SystemBaseHighColor}"
                                               OffsetX="0"
                                               OffsetY="0"
                                               OffsetZ="0"
                                               RelativeElement="{TemplateBinding RelativeElement}"
                                               RenderTransformOrigin="0.5,0.5">
                            <local:DropShadowPanel.RenderTransform>
                                <ScaleTransform ScaleX="0.91" ScaleY="0.93"/>
                            </local:DropShadowPanel.RenderTransform>
                        </local:DropShadowPanel>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>


    <Style TargetType="local:PomodoroStateButton">
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="Foreground" Value="{ThemeResource SystemBaseHighColor}"/>
        <Setter Property="BorderBrush" Value="Transparent"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="local:DropShadowPanel.Color" Value="Black"/>
        <Setter Property="local:DropShadowPanel.ShadowOpacity" Value="0"/>
        <Setter Property="Height" Value="48"/>
        <Setter Property="Width" Value="48"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:PomodoroStateButton">
                    <Border Background="Transparent"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            Padding="{TemplateBinding Padding}"
                            x:Name="RootGrid">
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualState x:Name="Normal" >
                                    <VisualState.Setters>
                                        <Setter Target="Outline.State" Value="Normal"/>
                                        <Setter Target="Inset.State" Value="Normal"/>
                                    </VisualState.Setters>
                                </VisualState>
                                <VisualState x:Name="PointerOver">
                                    <VisualState.Setters>
                                        <Setter Target="Outline.State" Value="PointerOver"/>
                                        <Setter Target="Inset.State" Value="PointerOver"/>
                                    </VisualState.Setters>
                                </VisualState>

                                <VisualState x:Name="Pressed">
                                    <VisualState.Setters>
                                        <Setter Target="Outline.State" Value="Pressed"/>
                                        <Setter Target="Inset.State" Value="Pressed"/>
                                    </VisualState.Setters>
                                </VisualState>

                                <VisualState x:Name="Disabled">
                                    <VisualState.Setters>
                                        <Setter Target="RootGrid.Background" Value="{ThemeResource ButtonRevealBackgroundDisabled}" />
                                        <Setter Target="RootGrid.BorderBrush" Value="{ThemeResource ButtonRevealBorderBrushDisabled}" />
                                        <Setter Target="RootGrid.Foreground" Value="{ThemeResource ButtonForegroundDisabled}" />
                                    </VisualState.Setters>
                                </VisualState>
                            </VisualStateGroup>

                            <VisualStateGroup x:Name="ProgressStates">
                                <VisualStateGroup.Transitions>
                                    <VisualTransition From="Idle" To="Busy">
                                        <Storyboard >
                                            <DoubleAnimation Storyboard.TargetName="ProgressToPointCollectionBridge" Storyboard.TargetProperty="Progress" To="1" EnableDependentAnimation="True" Duration="0:0:0.3">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="ShapeCompositeTransform" Storyboard.TargetProperty="Rotation" To="180" EnableDependentAnimation="True" Duration="0:0:0.3">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>

                                        </Storyboard>
                                    </VisualTransition>
                                    <VisualTransition From="Busy" To="Idle">
                                        <Storyboard >
                                            <DoubleAnimation Storyboard.TargetName="ProgressToPointCollectionBridge" Storyboard.TargetProperty="Progress" To="0" EnableDependentAnimation="True" Duration="0:0:0.3">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="ShapeCompositeTransform" Storyboard.TargetProperty="Rotation" To="360" EnableDependentAnimation="True" Duration="0:0:0.3">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </VisualTransition>
                                </VisualStateGroup.Transitions>
                                <VisualState x:Name="Idle" />
                                <VisualState x:Name="Busy">
                                    <VisualState.Setters>
                                        <Setter Target="ProgressToPointCollectionBridge.Progress"
                                                Value="1" />
                                        <Setter Target="ShapeCompositeTransform.Rotation" Value="180"/>
                                    </VisualState.Setters>
                                </VisualState>
                            </VisualStateGroup>

                            <VisualStateGroup x:Name="PromodoroStates">
                                <!--<VisualStateGroup.Transitions>
                                    <VisualTransition GeneratedDuration="0:0:3">
                                        <VisualTransition.GeneratedEasingFunction>
                                            <CubicEase EasingMode="EaseOut" />
                                        </VisualTransition.GeneratedEasingFunction>
                                    </VisualTransition>
                                </VisualStateGroup.Transitions>-->
                                <VisualState x:Name="Inwork" />
                                <VisualState x:Name="Break"/>
                            </VisualStateGroup>

                        </VisualStateManager.VisualStateGroups>
                        <Border.Resources>
                            <local:ProgressToPointCollectionBridge x:Name="ProgressToPointCollectionBridge"
                                           Progress="0">
                                <PointCollection>21.00,12.00 20.55,12.30 20.09,12.61 19.64,12.91 19.18,13.21 18.73,13.52 18.27,13.82 17.82,14.12 17.36,14.42 16.91,14.73 16.45,15.03 16.00,15.33 15.55,15.64 15.09,15.94 14.64,16.24 14.18,16.55 13.73,16.85 13.27,17.15 12.82,17.45 12.36,17.76 11.91,18.06 11.45,18.36 11.00,18.67 10.55,18.97 10.09,19.27 9.64,19.58 9.18,19.88 8.73,20.18 8.27,20.48 7.82,20.79 7.36,21.09 6.91,21.39 6.45,21.70 6.00,22.00 6.00,21.39 6.00,20.79 6.00,20.18 6.00,19.58 6.00,18.97 6.00,18.36 6.00,17.76 6.00,17.15 6.00,16.55 6.00,15.94 6.00,15.33 6.00,14.73 6.00,14.12 6.00,13.52 6.00,12.91 6.00,12.30 6.00,11.70 6.00,11.09 6.00,10.48 6.00,9.88 6.00,9.27 6.00,8.67 6.00,8.06 6.00,7.45 6.00,6.85 6.00,6.24 6.00,5.64 6.00,5.03 6.00,4.42 6.00,3.82 6.00,3.21 6.00,2.61 6.00,2.00 6.44,2.29 6.88,2.59 7.32,2.88 7.76,3.18 8.21,3.47 8.65,3.76 9.09,4.06 9.53,4.35 9.97,4.65 10.41,4.94 10.85,5.24 11.29,5.53 11.74,5.82 12.18,6.12 12.62,6.41 13.06,6.71 13.50,7.00 13.94,7.29 14.38,7.59 14.82,7.88 15.26,8.18 15.71,8.47 16.15,8.76 16.59,9.06 17.03,9.35 17.47,9.65 17.91,9.94 18.35,10.24 18.79,10.53 19.24,10.82 19.68,11.12 20.12,11.41 20.56,11.71</PointCollection>
                                <PointCollection>20.00,12.00 19.98,12.50 19.94,13.00 19.86,13.50 19.75,13.99 19.61,14.47 19.44,14.94 19.24,15.41 19.01,15.85 18.75,16.29 18.47,16.70 18.16,17.10 17.83,17.48 17.48,17.83 17.10,18.16 16.70,18.47 16.29,18.75 15.85,19.01 15.41,19.24 14.94,19.44 14.47,19.61 13.99,19.75 13.50,19.86 13.00,19.94 12.50,19.98 12.00,20.00 11.50,19.98 11.00,19.94 10.50,19.86 10.01,19.75 9.53,19.61 9.06,19.44 8.59,19.24 8.15,19.01 7.71,18.75 7.30,18.47 6.90,18.16 6.52,17.83 6.17,17.48 5.84,17.10 5.53,16.70 5.25,16.29 4.99,15.85 4.76,15.41 4.56,14.94 4.39,14.47 4.25,13.99 4.14,13.50 4.06,13.00 4.02,12.50 4.00,12.00 4.02,11.50 4.06,11.00 4.14,10.50 4.25,10.01 4.39,9.53 4.56,9.06 4.76,8.59 4.99,8.15 5.25,7.71 5.53,7.30 5.84,6.90 6.17,6.52 6.52,6.17 6.90,5.84 7.30,5.53 7.71,5.25 8.15,4.99 8.59,4.76 9.06,4.56 9.53,4.39 10.01,4.25 10.50,4.14 11.00,4.06 11.50,4.02 12.00,4.00 12.50,4.02 13.00,4.06 13.50,4.14 13.99,4.25 14.47,4.39 14.94,4.56 15.41,4.76 15.85,4.99 16.29,5.25 16.70,5.53 17.10,5.84 17.48,6.17 17.83,6.52 18.16,6.90 18.47,7.30 18.75,7.71 19.01,8.15 19.24,8.59 19.44,9.06 19.61,9.53 19.75,10.01 19.86,10.50 19.94,11.00 19.98,11.50</PointCollection>
                                <PointCollection>19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 19,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,19 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 5,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5 19,5</PointCollection>
                            </local:ProgressToPointCollectionBridge>

                        </Border.Resources>
                        <Grid>

                            <Viewbox Stretch="Uniform">
                                <Grid Height="24" Width="24" RenderTransformOrigin=".5,.5">
                                    <Grid.RenderTransform>
                                        <CompositeTransform x:Name="ShapeCompositeTransform"/>
                                    </Grid.RenderTransform>
                                    <local:ButtonDecorator  x:Name="Inset"
                                                        local:DropShadowPanel.ShadowOpacity="{TemplateBinding local:DropShadowPanel.ShadowOpacity}"
                                                        local:DropShadowPanel.BlurRadius="{TemplateBinding local:DropShadowPanel.BlurRadius}"
                                                        local:DropShadowPanel.Color="{TemplateBinding local:DropShadowPanel.Color}"
                                                        local:DropShadowPanel.OffsetX="{TemplateBinding local:DropShadowPanel.OffsetX}"
                                                        local:DropShadowPanel.OffsetY="{TemplateBinding local:DropShadowPanel.OffsetY}"
                                                        local:DropShadowPanel.OffsetZ="{TemplateBinding local:DropShadowPanel.OffsetZ}"
                                                        local:DropShadowPanel.IsMasked="{TemplateBinding local:DropShadowPanel.IsMasked}"
                                                        RelativeElement="{Binding ElementName=Shape}" 
                                                        Style="{StaticResource InsetPanel}"/>

                                    <!--<Polygon Points="{Binding Source={StaticResource ProgressToPointCollectionBridge},Path=Points}"
                                             Fill="{TemplateBinding Foreground}"
                                             Stroke="{TemplateBinding Foreground}"
                                             StrokeThickness="2"
                                             Stretch="None"
                                             StrokeEndLineCap="Round"
                                             x:Name="Shape">
                                     
                                    </Polygon>-->

                                    <Polygon Points="{Binding Source={StaticResource ProgressToPointCollectionBridge},Path=Points}"
                                             StrokeThickness="2"
                                             Stretch="None"
                                             StrokeEndLineCap="Round"
                                             x:Name="Shape">
                                        <Polygon.Fill>
                                            <local:PomodoroButtonBrush PomodoroColor="{Binding RelativeSource={RelativeSource Mode=TemplatedParent},Path=PomodoroColor}"
                                                                       BreakColor="{Binding RelativeSource={RelativeSource Mode=TemplatedParent},Path=BreakColor}"
                                                                       IsInPomodoro="{Binding RelativeSource={RelativeSource Mode=TemplatedParent},Path=IsInPomodoro}"/>
                                        </Polygon.Fill>
                                        <Polygon.Stroke>
                                            <local:PomodoroButtonBrush PomodoroColor="{Binding RelativeSource={RelativeSource Mode=TemplatedParent},Path=PomodoroColor}"
                                                                       BreakColor="{Binding RelativeSource={RelativeSource Mode=TemplatedParent},Path=BreakColor}"
                                                                       IsInPomodoro="{Binding RelativeSource={RelativeSource Mode=TemplatedParent},Path=IsInPomodoro}"/>
                                        </Polygon.Stroke>
                                    </Polygon>
                                    
                                    

                                    <local:OutlinePanel RelativeElement="{Binding ElementName=Shape}" x:Name="Outline" />
                                </Grid>
                            </Viewbox>
                        </Grid>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>
